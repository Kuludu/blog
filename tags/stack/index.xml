<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Stack on Kuluduçš„åšå®¢</title><link>https://blog.kuludu.net/tags/stack/</link><description>Recent content in Stack on Kuluduçš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>Kuludu</copyright><lastBuildDate>Fri, 25 Oct 2024 09:35:00 +0800</lastBuildDate><atom:link href="https://blog.kuludu.net/tags/stack/index.xml" rel="self" type="application/rss+xml"/><item><title>æœ‰é”æ ˆä¸æ— é”æ ˆï¼Œå®ç°ä¸æ€§èƒ½å¯¹æ¯”</title><link>https://blog.kuludu.net/article/lock-required-stack-vs-lock-free-stack/</link><pubDate>Fri, 25 Oct 2024 09:35:00 +0800</pubDate><guid>https://blog.kuludu.net/article/lock-required-stack-vs-lock-free-stack/</guid><description>&lt;p>å¤šçº¿ç¨‹åŒæ­¥æ˜¯ç°ä»£ç¨‹åºè®¾è®¡ä¸­ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œæƒ³è¦æ·±å…¥ç†è§£è¿™ä¸€é—®é¢˜ï¼Œå°±ä¸å¾—ä¸æ·±å…¥åˆ°å¤„ç†å™¨ä¸æ“ä½œç³»ç»Ÿçš„å…·ä½“å®ç°ä¸­ã€‚ä½†æ˜¯æˆ‘æ°´å¹³æœ‰é™â”‘(ï¿£Ğ” ï¿£)â”ï¼Œæœ¬æ–‡ä¸è¿‡äºè¯¦ç»†åœ°å»æ¢è®¨è¿™ä¸€é—®é¢˜ï¼Œè€Œæ˜¯ä»¥æœ‰é”æ ˆä¸æ— é”æ ˆä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œä¸»è¦å¯¹ä»£ç å®ç°ä¸å®éªŒæ€§èƒ½ä¸Šå¯¹ä¸¤è€…è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒã€‚&lt;/p>
&lt;h2 id="æœ‰é”æ ˆä¸æ— é”æ ˆ">æœ‰é”æ ˆä¸æ— é”æ ˆ
&lt;/h2>&lt;p>æœ‰é”æ ˆçš„å®ç°æ–¹å¼å…¶å®æ¯”è¾ƒç®€å•ï¼Œåœ¨çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„æ—¶å€™åŠ é”å³å¯ï¼Œåœ¨å®Œæˆå¯¹æ ˆçš„æ“ä½œè§£é™¤å¯¹é”çš„å æœ‰ã€‚ä½†æ˜¯åŠ é”è§£é”çš„è¿‡ç¨‹å¯¹èµ„æºçš„æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œå½“çº¿ç¨‹æ²¡æœ‰Acquireåˆ°é”çš„æ—¶å€™ä¼šå‘ç”ŸçŠ¶æ€çš„åˆ‡æ¢ï¼Œè¿™åœ¨éœ€è¦é«˜æ€§èƒ½è®¡ç®—çš„åœºæ™¯ä¸‹æˆ–è®¸å¹¶ä¸åˆé€‚ã€‚&lt;/p>
&lt;p>Compare And Swap(CAS)æ˜¯ä¸€ç§å¸¸è§çš„åŸå­æ“ä½œï¼Œæ˜¯å®ç°æ— é”åŒæ­¥çš„ä¸€ä¸ªæ–¹å¼ï¼Œå…¶ä¸»è¦æ€æƒ³å°±æ˜¯Compareå’ŒSwapä¸¤ä¸ªè¿‡ç¨‹ã€‚Compareçš„ç›®çš„ä¸»è¦æ˜¯æ¢æµ‹å†…å­˜ä¸­çš„å€¼æ˜¯å¦ä¸ºæœŸå¾…å€¼ï¼Œå¦‚æœæ˜¯åˆ™Swapä¸ºè®¾å®šçš„å€¼ã€‚è¿™ä¸»è¦ä¾èµ–äºå¤„ç†å™¨çš„å®ç°ï¼Œæ¯”å¦‚x86å¤„ç†å™¨çš„&lt;code>CMPXCHG&lt;/code>ä¸ARMå¤„ç†å™¨çš„&lt;code>LDREX/STREX&lt;/code>ã€‚&lt;/p>
&lt;h2 id="å®ç°ä¸å®éªŒ">å®ç°ä¸å®éªŒ
&lt;/h2>&lt;h3 id="cå®ç°">C++å®ç°
&lt;/h3>&lt;p>æœ¬æ–‡ä¸»è¦å¯¹æ¯”C++æ ‡å‡†åº“å®ç°çš„æ ˆï¼Œä¼šç”¨åˆ°ä¸€äº›æ¯”è¾ƒæ–°çš„C++æ ‡å‡†ï¼Œå®éªŒç¯å¢ƒä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>è…¾è®¯äº‘Cloud Studio 1C2Gï¼ˆè‡´è°¢ï¼ï¼‰&lt;/li>
&lt;li>gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.2)&lt;/li>
&lt;li>g++ experiment.cpp -o experiment -pthread&lt;/li>
&lt;/ul>
&lt;p>ä¸ºäº†å‡å°‘ä»£ç å†—ä½™ï¼Œä¸¤ä¸ªæ ˆå®ç°çš„å†…éƒ¨æ•°æ®ç»“æ„å‡ä¸ºä»¥ä¸‹ä»£ç æ®µã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Node&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥ä¸‹ä¸ºæœ‰é”æ ˆçš„å®ç°ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mtx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">new_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">head&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">T&lt;/span> &lt;span class="nf">top&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mtx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">top_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">top_node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Stack is empty.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">pop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mtx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">top_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">top_node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">next_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">head&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">next_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">delete&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Stack is empty.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">bool&lt;/span> &lt;span class="nf">is_empty&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="k">noexcept&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mtx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">head&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">nullptr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ‰é”æ ˆçš„å®ç°ä¸»è¦ä¾èµ–äº’æ–¥é”ï¼ˆmutex &amp;amp; unique_lockï¼‰å®ç°ï¼Œçº¿ç¨‹åœ¨è¿›è¡Œæ¯é¡¹æ“ä½œæ—¶éœ€è¦å…ˆAcquireé”çš„æ‰€æœ‰æƒï¼Œåœ¨æ‰§è¡Œå®Œæ“ä½œåéœ€è¦Releaseé”çš„æ‰€æœ‰æƒã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸å¯¹ä¿®æ”¹æ“ä½œçš„åˆæ³•æ€§è¿›è¡Œæ£€æŸ¥ï¼Œè€Œæ˜¯é€‰æ‹©ç›´æ¥å¯¹ä¸åˆæ³•çš„è¶Šç•Œæ“ä½œæŠ›å‡ºå¼‚å¸¸ã€‚æœ‰é”æ ˆçš„å®ç°ç®€å•ï¼Œç¬¦åˆä¸€èˆ¬çš„å¤šçº¿ç¨‹ç¼–ç¨‹é€»è¾‘æ¯”è¾ƒç›´è§‚ã€‚åœ¨è¿™é‡Œä½¿ç”¨æ ‡å‡†åº“è‡ªå¸¦çš„RAIIé”ï¼Œç¼–ç¨‹å®ç°éå¸¸ç®€å•ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ä¸ºæ— é”æ ˆå®ç°çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&amp;gt;&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">new_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">compare_exchange_weak&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">new_node&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_release&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">T&lt;/span> &lt;span class="nf">top&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">top_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_acquire&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">top_node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Stack is empty.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">pop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">top_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">top_node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">next_node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">compare_exchange_weak&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">top_node&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">next_node&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_release&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">delete&lt;/span> &lt;span class="n">top_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Stack is empty.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">bool&lt;/span> &lt;span class="nf">is_empty&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="k">noexcept&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_acquire&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">nullptr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯¹æ¯”æœ‰é”æ ˆï¼Œæ— é”æ ˆåœ¨å®ç°ä¸Šå›°éš¾äº†ä¸å°‘ï¼Œè¿™ä¸»è¦ç‰µæ¶‰åˆ°å¯¹CASçš„ç†è§£ä¸Šã€‚è¿™ä¸€éƒ¨åˆ†çš„ç†è®ºéƒ¨åˆ†åœ¨å‰æ–‡ä¸å‚è€ƒèµ„æ–™ä¸­æœ‰æ¯”è¾ƒè¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œå†ç®€å•å¯¹C++ä»£ç å®ç°æ–¹é¢åšä¸€ä¸ªè§£é‡Šï¼š&lt;/p>
&lt;ul>
&lt;li>headä½œä¸ºæ ˆé¡¶å…ƒç´ çš„æŒ‡é’ˆï¼Œåœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯åŸå­å˜é‡ç±»å‹ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸€ä¸ªCPU Instructionä¸­å®Œæˆå¯¹å˜é‡çš„æ“ä½œï¼Œä»è€Œé¿å…ä¸­é—´çŠ¶æ€çš„äº§ç”Ÿï¼Œä¹Ÿå°±ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ã€‚åŸå­æ“ä½œå­˜åœ¨å†…å­˜åºçš„æ¦‚å¿µï¼Œåœ¨è¿™é‡Œç”¨åˆ°äº†ä¸‰ç§å†…å­˜åºï¼Œåˆ†åˆ«è§£é‡Šå¦‚ä¸‹
&lt;ul>
&lt;li>memory_order_relaxed: æ¾æ•£å†…å­˜é¡ºåºã€‚è¿™ä¸ªæ¨¡å¼ä¿è¯äº†è¯»æ“ä½œä¸ä¼šè¢«é‡æ’ï¼Œä½†å¯¹äºå†™æ“ä½œæ²¡æœ‰ä»»ä½•ä¿è¯ã€‚&lt;/li>
&lt;li>memory_order_releaseï¼šé‡Šæ”¾å†…å­˜é¡ºåºã€‚ä¿éšœäº†è¯»å†™é¡ºåºï¼Œé€šå¸¸ä¸é€‚ç”¨äºload()ã€‚&lt;/li>
&lt;li>memory_order_acquireï¼šè·å–å†…å­˜é¡ºåºã€‚ä¿éšœäº†è¯»å†™é¡ºåºã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>atomic.load()&lt;/code>çš„ä½œç”¨æ˜¯å®‰å…¨åœ°è¯»å–ä¸€ä¸ªåŸå­å˜é‡ï¼Œå…¶ä¸­å‚æ•°ä¸ºå†…å­˜åºï¼ˆMemory Orderï¼‰ã€‚åœ¨Pushå’ŒPopæ“ä½œä¸­é€‰æ‹©çš„loadçš„å†…å­˜åºä¸ºmemory_order_relaxedï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡Œè€ƒè™‘CASæ–¹å¼ä¹±åºåœ°æ’å…¥ä¸åˆ é™¤å…ƒç´ ï¼Œå³å…ƒç´ æœ¬èº«çš„é¡ºåºå¹¶ä¸é‡è¦ï¼›è€Œåœ¨IsEmptyæ“ä½œä¸­çš„å†…å­˜åºä¸ºmemory_order_acquireï¼Œè¿™ä¸»è¦æ˜¯è€ƒè™‘åœ¨å½“å‰æ—¶é—´ç‚¹æ‰§è¡ŒIsEmptyçš„ç»“æœçš„æ­£ç¡®æ€§ã€‚&lt;/li>
&lt;li>&lt;code>atomic.compare_exchange_weak()&lt;/code>ç”¨äºæ‰§è¡ŒåŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼Œä¹Ÿå°±æ˜¯CASæœºåˆ¶çš„ä¸»è¦å®ç°ã€‚å…¶ä¸­ä¸€ä¸ªå‚æ•°ä¸ºExpectedï¼Œæ˜¯Compareè¿‡ç¨‹æ¯”è¾ƒçš„å€¼ï¼›ç¬¬äºŒä¸ªå˜é‡ä¸ºDesireï¼Œæ˜¯Swapè¿‡ç¨‹æƒ³è¦äº¤æ¢ä¸ºçš„å€¼ã€‚å…¶å·¥ä½œè¿‡ç¨‹ä¸ºï¼Œæ¯”è¾ƒatomicå˜é‡ä¸Expectedæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™äº¤æ¢ä¸ºDesireï¼Œå¦åˆ™é€€åŒ–ä¸ºä¸€ä¸ªloadçš„è¿‡ç¨‹ï¼Œå°†æœ€æ–°çš„atomicçš„å€¼åŠ è½½è¿›Desireã€‚åä¸¤ä¸ªå‚æ•°åˆ™ä¸ºæ¯”è¾ƒsuccessæˆ–failureåçš„å†…å­˜åºã€‚å€¼å¾—ä¸€æçš„æ˜¯&lt;code>atomic.compare_exchange_strong()&lt;/code>ä¹Ÿå€¼å¾—äº†è§£ï¼Œå…¶ä¸»è¦é€‚ç”¨äºä¸éœ€è¦å¾ªç¯é‡è¯•çš„åœºæ™¯ï¼Œå…³æ³¨å¯é æ€§çš„åœºæ™¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;em>è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æœ‰ä¸€äº›éš¾ç†è§£ï¼Œå¦‚æœè¯»åˆ°è¿™é‡Œä½ æœ‰æ‰€å›°æƒ‘ï¼Œå»ºè®®å»æŸ¥æ‰¾æ›´å¤šå…³äºCASæœºåˆ¶åŠC++å†…å­˜åºçš„ç›¸å…³èµ„æ–™ï¼Œæœ¬æ–‡ä¸å†è¯¦ç»†å±•å¼€&lt;del>ï¼ˆæ²¡é”™æˆ‘ä¹Ÿè®²ä¸æ˜ç™½ğŸ˜”ï¼‰&lt;/del>ã€‚&lt;/em>&lt;/p>
&lt;p>ä¸ºäº†è¿›è¡Œå…¬å¹³å¯¹æ¯”ï¼Œåœ¨è¿™é‡Œå®šä¹‰å®éªŒä»»åŠ¡ä¸ºï¼šåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ&lt;code>1,000,000&lt;/code>æ¬¡å…¥æ ˆæ“ä½œï¼Œå¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">auto&lt;/span> &lt;span class="n">ok&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pool&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">enqueue&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">1000000&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿™é‡Œæˆ‘ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œä»ä»»åŠ¡åˆ›å»ºå¼€å§‹è®¡æ—¶ï¼Œä»¥ä¸¤ä¸ªçº¿ç¨‹çš„å…¥æ ˆä»»åŠ¡ç»“æŸæˆªæ­¢è®¡æ—¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">auto&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">high_resolution_clock&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Assign tasks to thread pool.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ok_1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ok_2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">high_resolution_clock&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">duration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">duration_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">microseconds&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stop&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">duration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ¬æ–‡æ‰€æåˆ°çš„çº¿ç¨‹æ± ã€æœ‰é”æ ˆå’Œæ— é”æ ˆçš„å®Œæ•´ä»£ç å®ç°å‡å¯åœ¨æœ¬äººçš„å¼€æºé¡¹ç›®&lt;a class="link" href="https://github.com/Kuludu/MyDSA/" target="_blank" rel="noopener"
>MyDSA&lt;/a>ä¸­æ‰¾åˆ°ï¼ˆå¦‚æœå¯¹ä½ æœ‰ç”¨ï¼Œä¹Ÿéº»çƒ¦ç‚¹ä¸€ä¸ªå°æ˜Ÿæ˜Ÿå‘€ï¼ï¼‰ã€‚&lt;/p>
&lt;h3 id="å®éªŒç»“æœ">å®éªŒç»“æœ
&lt;/h3>&lt;p>å®éªŒç»“æœå¦‚ä¸‹è¡¨ï¼ˆå•ä½ä¸ºmicrosecondï¼‰ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•&lt;/th>
&lt;th>æœ‰é”æ ˆ&lt;/th>
&lt;th>æ— é”æ ˆ&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>#1&lt;/td>
&lt;td>1,003,863&lt;/td>
&lt;td>399,217&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>#2&lt;/td>
&lt;td>884,579&lt;/td>
&lt;td>186,314&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>#3&lt;/td>
&lt;td>1,013,956&lt;/td>
&lt;td>427,235&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Avg&lt;/td>
&lt;td>967,466&lt;/td>
&lt;td>337,588&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä»å®éªŒç»“æœçš„å¹³å‡å€¼æ¥çœ‹ï¼Œæœ‰é”æ ˆç›¸è¾ƒäºæ— é”æ ˆå¿«äº†2.86å€ã€‚å½“ç„¶è¿™åªæ˜¯ä»å…¥æ ˆæ•ˆç‡ä¸Šæ¥è¿›è¡Œæ¯”è¾ƒçš„ï¼Œå¦‚æœåŠ ä¸Šéšæœºå‡ºæ ˆä¸å–å€¼æ“ä½œå¯èƒ½ä¼šæœ‰å·®å¼‚ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="reference">Reference
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://tech.meituan.com/2024/07/19/multi-threading-and-multi-thread-synchronization.html" target="_blank" rel="noopener"
>åŸºæœ¬åŠŸ | ä¸€æ–‡è®²æ¸…å¤šçº¿ç¨‹å’Œå¤šçº¿ç¨‹åŒæ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/davidhopper/article/details/131430830" target="_blank" rel="noopener"
>C++æ— é”ç¼–ç¨‹â€”â€”æ— é”æ ˆ(lock-free stack)&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.cnblogs.com/ljmiao/p/18145946" target="_blank" rel="noopener"
>C++å…­ç§å†…å­˜åºè¯¦è§£&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>